<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MONTE SEU ACAI - SABOR A칂A칈TERIA</title>

    <meta property="og:title" content="MONTE SEU ACAI - SABOR A칂A칈TERIA">
    <meta property="og:description" content="Confira nosso card치pio completo de a칞a칤s, cremes e combos. Monte o seu e pe칞a agora!">
    <meta property="og:image" content="https://raw.githubusercontent.com/saboracaiteria/SABOR-/main/175.jpg"> 
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://saboracaiteria.github.io/SABOR-/">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="MONTE SEU ACAI - SABOR A칂A칈TERIA">
    <meta name="twitter:description" content="Confira nosso card치pio completo de a칞a칤s, cremes e combos. Monte o seu e pe칞a agora!">
    <meta name="twitter:image" content="https://raw.githubusercontent.com/saboracaiteria/SABOR-/main/175.jpg">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* Base font inspired by Instagram's clean look */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #000000; /* Super AMOLED Black */
        }
        
        /* Instagram Gradient Text */
        .instagram-gradient-text {
            background: linear-gradient(90deg, #f9ce34, #ee2a7b, #6228d7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }

        /* Instagram Gradient for Buttons */
        .btn-gradient {
            background-image: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
            transition: opacity 0.3s ease;
        }
        .btn-gradient:hover {
            opacity: 0.9;
        }

        /* Custom scrollbar for modal content */
        .modal-body::-webkit-scrollbar {
            width: 8px;
        }
        .modal-body::-webkit-scrollbar-track {
            background: #1F2937; /* gray-800 */
            border-radius: 10px;
        }
        .modal-body::-webkit-scrollbar-thumb {
            background: #4B5563; /* gray-600 */
            border-radius: 10px;
        }
        .modal-body::-webkit-scrollbar-thumb:hover {
            background: #6B7280; /* gray-500 */
        }

        /* Hide spin buttons for number inputs */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
        
        /* Custom Checkbox and Radio Styles */
        input[type="checkbox"]:checked, input[type="radio"]:checked {
            background-color: #ee2a7b;
            border-color: #ee2a7b;
        }
        
        /* Highlight radio button card when checked */
        input[type="radio"]:checked + div {
             border-color: #ee2a7b;
             box-shadow: 0 0 10px rgba(238, 42, 123, 0.5);
        }

        /* Transitions for modals */
        .modal {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            opacity: 0;
            transform: scale(0.95);
            pointer-events: none;
        }
        .modal.flex {
            opacity: 1;
            transform: scale(1);
            pointer-events: auto;
        }
        
        /* Product card hover effect */
        .product-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.25);
        }

        /* Bouncing arrow animation */
        @keyframes bounce-horizontal {
            0%, 20%, 50%, 80%, 100% {
                transform: translateX(0);
            }
            40% {
                transform: translateX(-10px);
            }
            60% {
                transform: translateX(-5px);
            }
        }
        .animate-bounce-horizontal {
            animation: bounce-horizontal 2s infinite;
        }
    </style>
</head>
<body class="bg-black text-gray-300">

    <div id="closing-timer-container" class="hidden fixed top-2 left-4 text-xs text-gray-200 z-50 bg-gray-900 bg-opacity-80 border border-gray-700 px-3 py-1 rounded-full shadow-lg items-center gap-2">
        <i class="fas fa-stopwatch text-red-400"></i>
        <div>Fecha em: <span id="closing-timer" class="font-bold tracking-wider">--:--:--</span></div>
    </div>

    <div id="opening-timer-container" class="hidden fixed top-11 left-4 text-xs text-gray-200 z-50 bg-gray-900 bg-opacity-80 border border-gray-700 px-3 py-1 rounded-full shadow-lg items-center gap-2">
        <i class="fas fa-stopwatch text-green-400"></i>
        <div>Abre em: <span id="opening-timer" class="font-bold tracking-wider">--:--:--</span></div>
    </div>

    <div id="delivery-countdown-container" class="hidden fixed top-20 left-4 text-xs text-gray-200 z-50 bg-gray-900 bg-opacity-80 border border-gray-700 px-3 py-1 rounded-full shadow-lg items-center gap-2">
        <i class="fas fa-motorcycle text-blue-400"></i>
        <div>Delivery em: <span id="delivery-countdown-timer" class="font-bold tracking-wider">--:--:--</span></div>
    </div>

    <div id="online-counter-container" class="fixed top-2 right-4 text-xs text-gray-300 flex items-center z-50 bg-gray-900 bg-opacity-70 border border-gray-700 px-2 py-1 rounded-full shadow-lg">
        <span class="relative flex h-2 w-2 mr-2">
          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
          <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
        </span>
        <div><span id="online-count">12</span> pessoas online</div>
    </div>


    <div class="container mx-auto p-4 max-w-3xl">

        <header class="flex items-center gap-4 md:gap-8 mb-8 p-4 border-b border-gray-800">
            <div class="w-20 h-20 md:w-28 md:h-28 rounded-full flex-shrink-0 bg-gray-800 p-1 flex items-center justify-center instagram-gradient-bg-ring" style="background: linear-gradient(45deg, #f9ce34, #ee2a7b, #6228d7);">
                <div class="bg-gray-900 rounded-full w-full h-full p-0.5">
                      <img src="175.jpg" alt="Logo da Sabor A칞a칤teria" class="w-full h-full rounded-full object-cover">
                </div>
            </div>
            <div class="flex-grow">
                <div class="flex items-center gap-2">
                    <h1 class="text-2xl md:text-3xl font-bold tracking-tight text-gray-100">sabor acaiteria</h1>
                </div>
                <p class="text-sm text-gray-400 mt-2">
                    <i class="fas fa-clock mr-1 opacity-70"></i>
                    <span id="store-hours-display">Carregando hor치rio...</span>
                    <span id="store-status-indicator" class="ml-2 px-2 py-0.5 text-xs rounded-full font-semibold"></span>
                </p>
                <p class="text-xs text-gray-400 mt-2">Cana칚 dos Caraj치s</p>
                <p id="store-address-display" class="text-xs text-gray-500 mt-1">Carregando endere칞o...</p>
                <div class="mt-4 flex justify-around text-center">
                    <div>
                        <p class="font-bold text-gray-100">38</p>
                        <p class="text-sm text-gray-400">posts</p>
                    </div>
                    <div>
                        <p class="font-bold text-gray-100">1.679</p>
                        <p class="text-sm text-gray-400">seguidores</p>
                    </div>
                    <div>
                        <p class="font-bold text-gray-100">3.541</p>
                        <p class="text-sm text-gray-400">seguindo</p>
                    </div>
                </div>
                <div class="mt-4 flex gap-2 items-center relative">
                    <div class="absolute -left-12 text-green-400 animate-bounce-horizontal">
                        <i class="fas fa-arrow-right text-4xl" style="filter: drop-shadow(0 2px 3px rgba(0,0,0,0.5));"></i>
                    </div>
                    <a href="https://www.instagram.com/sabor_acaiteria/profilecard/?igsh=NjF2ZWMwNHNiNzI0" target="_blank" class="flex-1 text-center btn-gradient text-white font-bold py-2 px-4 rounded-lg text-sm">
                        Seguir
                    </a>
                    <a id="message-button-link" href="#" target="_blank" class="flex-1 text-center btn-gradient text-white font-bold py-2 px-4 rounded-lg text-sm">
                        Mensagem
                    </a>
                    <a href="https://aiqfome.com/PA/canaa-dos-carajas/sabor-acaiteria" target="_blank" class="flex-1 text-center btn-gradient text-white font-bold py-2 px-4 rounded-lg text-sm">
                        aiqfome
                    </a>
                </div>
            </div>
        </header>


        <div id="store-status-banner" class="hidden mb-6"></div>
        <div id="delivery-time-banner" class="hidden mb-6"></div>

        <main class="space-y-8">
            <section id="tamanhos">
                <p class="text-lg text-gray-400 mb-4 text-center">游녢 Clique em <span class="font-bold text-white">"Montar"</span> para come칞ar 游녢</p>
                <h2 class="text-2xl font-bold text-gray-100 mb-4 tracking-wide">MONTE SEU A칂A칈</h2>
                <div id="product-list" class="grid grid-cols-2 gap-3">
                    </div>
            </section>
        </main>

        <footer class="text-center mt-12 space-y-4 py-6 border-t border-gray-800">
            <div class="text-gray-500 text-sm">
                <p>Siga-nos no Instagram: 
                    <a href="https://www.instagram.com/sabor_acaiteria/profilecard/?igsh=NjF2ZWMwNHNiNzI0" target="_blank" class="font-semibold text-gray-300 hover:underline">@sabor_acaiteria</a>
                </p>
                 <a href="#" onclick="app.openAdminPanel(event)" class="mt-4 inline-block text-gray-600 hover:text-gray-400 transition-colors text-xs">
                    Painel do Administrador
                </a>
            </div>
        </footer>
    </div>

    <a id="whatsapp-link" href="#" target="_blank" class="fixed bottom-5 left-5 z-50">
        <button class="bg-green-500 text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center hover:bg-green-600 transition-transform transform hover:scale-110">
            <i class="fab fa-whatsapp text-3xl"></i>
        </button>
    </a>

    <div id="cart-button" class="fixed bottom-5 right-5 z-50 hidden">
        <button onclick="app.toggleCartModal()" class="btn-gradient text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center transition-transform transform hover:scale-110">
            <i class="fas fa-shopping-bag text-2xl"></i>
            <span id="cart-count" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center border-2 border-gray-800">0</span>
        </button>
    </div>

    <div id="combo-size-modal" class="modal fixed inset-0 bg-black bg-opacity-70 z-50 hidden items-center justify-center p-4">
        <div class="bg-gray-900 border border-gray-700 text-gray-300 rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] flex flex-col">
            <div class="p-4 border-b border-gray-700 flex justify-between items-center">
                <h3 id="combo-size-modal-title" class="text-xl font-bold text-white">Escolha o Tamanho</h3>
                <button onclick="app.closeComboSizeModal()" class="text-gray-400 hover:text-white"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div id="combo-size-modal-body" class="p-6 space-y-4 overflow-y-auto modal-body">
                </div>
            <div class="p-4 bg-black border-t border-gray-700 flex justify-end">
                <button id="select-combo-size-btn" class="btn-gradient text-white font-bold py-3 px-6 rounded-lg flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    Continuar <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="item-modal" class="modal fixed inset-0 bg-black bg-opacity-70 z-50 hidden items-center justify-center p-4">
        <div class="bg-gray-900 border border-gray-700 text-gray-300 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col">
            <div class="p-4 border-b border-gray-700 flex justify-between items-center">
                <h3 id="modal-title" class="text-xl font-bold text-white">Monte seu A칞a칤</h3>
                <button onclick="app.closeItemModal()" class="text-gray-400 hover:text-white"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div id="modal-body" class="p-6 space-y-6 overflow-y-auto modal-body">
                </div>
            <div class="p-4 bg-black border-t border-gray-700 flex justify-between items-center">
                <div>
                    <span class="text-md font-medium text-gray-400">Total:</span>
                    <span id="modal-item-total" class="text-2xl font-bold text-white ml-2">R$ 0,00</span>
                </div>
                <button id="add-to-cart-btn" class="btn-gradient text-white font-bold py-3 px-6 rounded-lg flex items-center gap-2">
                    Adicionar ao Carrinho
                </button>
            </div>
        </div>
    </div>

    <div id="cart-modal" class="modal fixed inset-0 bg-black bg-opacity-70 z-50 hidden items-center justify-center p-4">
         <div class="bg-gray-900 border border-gray-700 text-gray-300 rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col">
            <div class="p-4 border-b border-gray-700 flex justify-between items-center">
                <h3 class="text-xl font-bold text-white">Seu Carrinho e Pedido</h3>
                <button onclick="app.toggleCartModal()" class="text-gray-400 hover:text-white"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div class="p-6 space-y-6 overflow-y-auto modal-body">
                <div id="cart-items-container"></div>
                <div id="cart-summary-details" class="pt-4 mt-4 border-t border-gray-700 space-y-2 hidden">
                      <div class="flex justify-between text-gray-400">
                          <span>Subtotal</span>
                          <span id="cart-subtotal">R$ 0,00</span>
                      </div>
                      <div class="flex justify-between text-gray-400">
                          <span>Taxa de Entrega</span>
                          <span id="cart-delivery-fee">R$ 0,00</span>
                      </div>
                </div>
                
                <div id="coupon-container" class="space-y-4 pt-6 border-t border-gray-700">
                    </div>

                <div id="checkout-form" class="space-y-4 pt-6 border-t border-gray-700 hidden">
                    <h4 class="text-lg font-bold text-white">Informa칞칫es do Pedido</h4>
                    <div id="delivery-options">
                        <div class="flex flex-col sm:flex-row gap-4">
                            <label id="delivery-option-delivery" class="flex-1">
                                <input type="radio" name="delivery_option" value="delivery" class="hidden" checked>
                                <div class="flex items-center p-3 border-2 border-gray-600 rounded-lg cursor-pointer transition-all">
                                    <div class="flex items-center">
                                        <span class="mr-3"><i class="fas fa-motorcycle text-xl text-pink-500"></i></span>
                                        <div><span class="font-semibold text-gray-200 block">Delivery</span><span class="text-sm text-gray-500">20-60 min</span></div>
                                    </div>
                                </div>
                            </label>
                            <label id="delivery-option-takeout" class="flex-1">
                                <input type="radio" name="delivery_option" value="takeout" class="hidden">
                                <div class="flex items-center p-3 border-2 border-gray-600 rounded-lg cursor-pointer transition-all">
                                    <div class="flex items-center">
                                        <span class="mr-3"><i class="fas fa-store text-xl text-pink-500"></i></span>
                                        <div><span class="font-semibold text-gray-200 block">Retirar na Loja</span><span class="text-sm text-gray-500">20-30 min</span></div>
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>
                    <div>
                        <input type="text" id="customer-name" class="mt-1 block w-full bg-gray-800 border-2 border-gray-600 rounded-md shadow-sm focus:ring-pink-500 focus:border-pink-500 p-3 text-base text-white placeholder-gray-400" placeholder="Seu Nome" required>
                    </div>
                    <div id="delivery-fields" class="space-y-4">
                         <div>
                            <select id="neighborhood" class="mt-1 block w-full bg-gray-800 border-2 border-gray-600 rounded-md shadow-sm focus:ring-pink-500 focus:border-pink-500 p-3 text-base text-white">
                                <option value="" data-fee="0">-- Selecione o Bairro --</option>
                                <option value="Jardim Europa" data-fee="9.00">Jardim Europa (R$ 9,00)</option>
                                <option value="Amec" data-fee="9.00">Amec (R$ 9,00)</option>
                                <option value="Vale dos Sonhos 1" data-fee="9.00">Vale dos Sonhos 1 (R$ 9,00)</option>
                                <option value="Vale dos Sonhos 2" data-fee="9.00">Vale dos Sonhos 2 (R$ 9,00)</option>
                                <option value="Vale da Ben칞칚o" data-fee="9.00">Vale da Ben칞칚o (R$ 9,00)</option>
                                <option value="Jardim do Lago" data-fee="12.00">Jardim do Lago (R$ 12,00)</option>
                                <option value="Casas Populares" data-fee="9.00">Casas Populares (R$ 9,00)</option>
                                <option value="Nova Esperan칞a 2" data-fee="9.00">Nova Esperan칞a 2 (R$ 9,00)</option>
                                <option value="Outro Bairro" data-fee="7.00">Outro Bairro (Taxa Padr칚o R$ 7,00)</option>
                            </select>
                        </div>
                        <div>
                            <input type="text" id="customer-address" class="mt-1 block w-full bg-gray-800 border-2 border-gray-600 rounded-md shadow-sm focus:ring-pink-500 focus:border-pink-500 p-3 text-base text-white placeholder-gray-400" placeholder="Endere칞o Completo (Rua, N칰mero, Comp.)" required>
                        </div>
                    </div>
                     <div>
                        <select id="payment-method" class="mt-1 block w-full bg-gray-800 border-2 border-gray-600 rounded-md shadow-sm focus:ring-pink-500 focus:border-pink-500 p-3 text-base text-white">
                            <option>Pix</option>
                            <option>Cart칚o de Cr칠dito (na entrega)</option>
                            <option>Cart칚o de D칠bito (na entrega)</option>
                            <option>Dinheiro</option>
                        </select>
                        <p class="text-xs text-yellow-400 mt-2"><i class="fas fa-info-circle mr-1"></i>Observa칞칚o: n칚o aceitamos VR e vales refei칞칚o no momento.</p>
                    </div>
                     <div>
                        <textarea id="observations" rows="3" class="mt-1 block w-full bg-gray-800 border-2 border-gray-600 rounded-md shadow-sm focus:ring-pink-500 focus:border-pink-500 p-3 text-base text-white placeholder-gray-400" placeholder="Observa칞칫es (Ex: Troco para R$50, sem cebola, etc.)"></textarea>
                    </div>
                </div>
            </div>
            <div class="p-4 bg-black border-t border-gray-700 flex justify-between items-center">
                 <div>
                    <span class="text-md font-medium text-gray-400">Total:</span>
                    <span id="cart-total" class="text-2xl font-bold text-white ml-2">R$ 0,00</span>
                </div>
                <button onclick="app.finalizeOrder()" class="btn-gradient text-white font-bold py-3 px-6 rounded-lg transition-all flex items-center gap-2">
                    <i class="fab fa-whatsapp"></i> Finalizar Pedido
                </button>
            </div>
        </div>
    </div>

    <div id="confirmation-modal" class="modal fixed inset-0 bg-black bg-opacity-80 z-50 hidden items-center justify-center p-4">
        <div class="bg-gray-900 text-gray-300 rounded-2xl shadow-2xl w-full max-w-lg text-center p-8">
            <div id="confirmation-icon"><i class="fas fa-check-circle text-green-500 text-6xl mb-4"></i></div>
            <h3 id="confirmation-title" class="text-2xl font-bold text-white mb-2">Pedido Recebido!</h3>
            <p id="confirmation-message" class="text-gray-400 mb-6">Seu pedido foi gerado! Clique no bot칚o abaixo para encaminh치-lo para o WhatsApp da loja e finalizar a compra.</p>
            <div id="order-summary" class="text-left bg-gray-800 p-4 rounded-lg mb-6 max-h-60 overflow-y-auto modal-body"></div>
            <div id="initial-confirm-buttons" class="flex flex-col sm:flex-row gap-4 justify-center">
                 <button onclick="app.sendOrderViaWhatsApp()" class="w-full btn-gradient text-white font-bold py-3 px-6 rounded-lg transition-all flex items-center justify-center gap-2">
                    <i class="fab fa-whatsapp"></i> Enviar Pedido
                </button>
                <button onclick="app.closeConfirmationModal()" class="w-full bg-gray-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-gray-500 transition-all">Fechar</button>
            </div>
            <div id="post-send-buttons" class="hidden flex-col gap-4 justify-center">
                 <p class="text-sm text-yellow-400 mb-4">Ap칩s enviar a mensagem no WhatsApp, confirme abaixo para limpar seu carrinho.</p>
                 <button onclick="app.confirmOrderSent()" class="w-full btn-gradient text-white font-bold py-3 px-6 rounded-lg transition-all flex items-center justify-center gap-2">
                    <i class="fas fa-check-square"></i> Pedido Enviado, Limpar Carrinho
                </button>
                <button onclick="app.closeConfirmationModal()" class="w-full bg-gray-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-gray-500 transition-all">Manter Carrinho e Fechar</button>
            </div>
        </div>
    </div>
    
    <div id="alert-modal" class="modal fixed inset-0 bg-black bg-opacity-70 z-[60] hidden items-center justify-center p-4">
        <div class="bg-gray-900 text-gray-300 rounded-2xl shadow-2xl w-full max-w-sm text-center p-6">
            <div id="alert-icon" class="mx-auto mb-4"></div>
            <h3 id="alert-title" class="text-xl font-bold text-white mb-2">Aten칞칚o!</h3>
            <p id="alert-message" class="text-gray-400 mb-6">Mensagem de alerta.</p>
            <button onclick="app.closeAlertModal()" class="w-full btn-gradient text-white font-bold py-2 px-6 rounded-lg transition-all">OK</button>
        </div>
    </div>
    
    <div id="admin-modal" class="modal fixed inset-0 bg-black bg-opacity-80 z-[70] hidden items-center justify-center p-4">
        <div class="bg-gray-900 text-gray-200 rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col">
            <div class="p-4 border-b border-gray-700 flex justify-between items-center">
                <h3 class="text-2xl font-bold text-yellow-400"><i class="fas fa-user-shield mr-2"></i>Painel do Administrador</h3>
                <button onclick="app.closeAdminModal()" class="text-gray-400 hover:text-red-500"><i class="fas fa-times text-2xl"></i></button>
            </div>
            <div id="admin-body" class="p-6 space-y-6 overflow-y-auto modal-body"></div>
            <div class="p-4 bg-black border-t border-gray-700 flex flex-wrap justify-between items-center gap-4">
                <button onclick="app.saveAdminChanges()" class="bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700"><i class="fas fa-save mr-2"></i> Salvar Altera칞칫es</button>
                <button onclick="app.resetToDefaults()" class="bg-yellow-600 text-gray-900 font-bold py-2 px-4 rounded-lg hover:bg-yellow-700"><i class="fas fa-undo mr-2"></i> Restaurar Padr칚o</button>
            </div>
        </div>
    </div>
    <div id="password-modal" class="modal fixed inset-0 bg-black bg-opacity-70 z-[80] hidden items-center justify-center p-4">
        <div class="bg-gray-900 text-gray-200 rounded-2xl shadow-2xl w-full max-w-sm text-center p-6">
            <h3 class="text-xl font-bold text-yellow-400 mb-4">Acesso Restrito</h3>
            <p class="text-gray-400 mb-4">Insira a senha de administrador.</p>
            <input type="password" id="admin-password-input" class="block w-full bg-gray-800 border-2 border-gray-600 rounded-md p-3 text-white">
            <div class="mt-6 flex gap-4">
                <button onclick="app.closePasswordModal()" class="w-full bg-gray-600 font-bold py-2 px-6 rounded-lg hover:bg-gray-500">Cancelar</button>
                <button onclick="app.checkAdminPassword()" class="w-full bg-yellow-600 text-gray-900 font-bold py-2 px-6 rounded-lg hover:bg-yellow-700">Entrar</button>
            </div>
        </div>
    </div>
    <div id="confirm-action-modal" class="modal fixed inset-0 bg-black bg-opacity-70 z-[80] hidden items-center justify-center p-4">
        <div class="bg-gray-900 text-gray-200 rounded-2xl shadow-2xl w-full max-w-sm text-center p-6">
            <div id="confirm-action-icon" class="mx-auto mb-4"><i class="fas fa-exclamation-triangle text-yellow-500 text-5xl"></i></div>
            <h3 id="confirm-action-title" class="text-xl font-bold text-gray-100 mb-2">Confirmar A칞칚o</h3>
            <p id="confirm-action-message" class="text-gray-400 mb-6">Voc칡 tem certeza?</p>
            <div class="mt-6 flex gap-4">
                <button id="confirm-action-cancel-btn" class="w-full bg-gray-600 font-bold py-2 px-6 rounded-lg hover:bg-gray-500">Cancelar</button>
                <button id="confirm-action-confirm-btn" class="w-full bg-red-600 font-bold py-2 px-6 rounded-lg hover:bg-red-700">Confirmar</button>
            </div>
        </div>
    </div>
    
    <script>
    // --- APP GLOBAL OBJECT ---
    const app = {
        // --- APPLICATION STATE ---
        cart: [],
        currentItem: null,
        whatsAppMessage: '',
        isStoreOpen: false,
        isDeliveryTime: false,
        adminSettings: {},
        products: [],
        toppings: {},
        selectedComboProductId: null,
        countdownInterval: null,
        openingCountdownInterval: null,
        deliveryCountdownInterval: null,
        
        // --- CUPON STATE ---
        COUPON_STORAGE_KEY: 'saborAcaiteriaCouponHistory',
        coupons: [
            { code: 'TAXAZERO', type: 'free_delivery', value: 0 },
            { code: 'SABOR10', type: 'percentage', value: 0.10 }, // 10%
            { code: 'SABOR15', type: 'percentage', value: 0.15 }, // 15%
            { code: 'SABOR25', type: 'percentage', value: 0.25 }  // 25%
        ],
        appliedCoupon: null, // { code, type, value, discountAmount, isDeliveryFree }
        couponHistory: {}, // { 'CODE': 'YYYY-MM-DD', ... }

        // --- DEFAULT DATA (for initial load or reset) ---
        defaultAdminSettings: {
            storeStatus: 'auto', // 'auto', 'open', 'closed'
            deliveryMode: 'both', // 'both', 'delivery', 'takeout'
            whatsappNumber: '5594991623576',
            address: 'Av. rio Branco. novo Horizonte.. antigo Obba a칞a칤',
            
            // --- HOR츼RIO ATUALIZADO ---
            // Os hor치rios de abertura e fechamento s칚o din칙micos dependendo do dia
            // Os dias openDays s칚o todos, mas com hor치rios diferentes
            openDays: [0, 1, 2, 3, 4, 5, 6], 
            
            // Ser치 usado para o banner de abertura/fechamento
            // Estes hor치rios ser칚o ignorados para o c치lculo do status, mas precisam ser definidos
            // Vamos usar o hor치rio do dia de semana como fallback para exibi칞칚o no banner
            openingTime: '19:15', // Usado para banner, mas ignorado no c치lculo do status
            closingTime: '22:00', // Usado para banner, mas ignorado no c치lculo do status
            
            // Hor치rios de Abertura/Fechamento por dia da semana (Domingo=0 a S치bado=6)
            dailyHours: [
                { open: '15:30', close: '21:45' }, // Domingo (0)
                { open: '19:15', close: '22:00' }, // Segunda (1)
                { open: '19:15', close: '22:00' }, // Ter칞a (2)
                { open: '19:15', close: '22:00' }, // Quarta (3)
                { open: '19:15', close: '22:00' }, // Quinta (4)
                { open: '19:15', close: '22:00' }, // Sexta (5)
                { open: '15:30', close: '21:45' }  // S치bado (6)
            ],
            
            // Delivery come칞a assim que a loja abre
            weekdayDeliveryStartTime: '19:15', 
            weekendDeliveryStartTime: '15:30'
            // --- FIM DO HOR츼RIO ATUALIZADO ---
        },
        defaultProducts: [
            { id: 1, name: 'Copo 300ml', price: 14.00, disabled: false, type: 'base_acai', description: 'Monte seu a칞a칤 com seus acompanhamentos preferidos.' },
            { id: 2, name: 'Copo 400ml', price: 17.00, disabled: false, type: 'base_acai', description: 'Monte seu a칞a칤 com seus acompanhamentos preferidos.' },
            { id: 3, name: 'Copo 500ml', price: 20.00, disabled: false, type: 'base_acai', description: 'Monte seu a칞a칤 com seus acompanhamentos preferidos.' },
            // A barca (id: 22) foi removida aqui
            { id: 5, name: 'Diet Granola', disabled: false, type: 'combo_selectable_size', description: 'Sugest칚o: granola, leite em p칩, leite condensado', sizesKey: 'cupSizes' },
            { id: 6, name: 'Refrescante', disabled: false, type: 'combo_selectable_size', description: 'Sugest칚o: sorvete, calda de chocolate, leite em p칩, leite condensado', sizesKey: 'cupSizes' },
            { id: 7, name: 'Mega Especial', disabled: false, type: 'combo_selectable_size', description: 'Sugest칚o: leite em p칩, leite condensado, banana, creme de avel칚 (Nutella)', sizesKey: 'cupSizes' },
            { id: 8, name: 'Preferido', disabled: false, type: 'combo_selectable_size', description: 'Sugest칚o: pa칞oca, leite em p칩, leite condensado, creme de avel칚 (Nutella)', sizesKey: 'cupSizes' },
            { id: 9, name: 'Maltine +', disabled: false, type: 'combo_selectable_size', description: 'Sugest칚o: ovomaltine, tapioca, leite em p칩, leite condensado', sizesKey: 'cupSizes' },
            { id: 10, name: 'Amendoimix', disabled: false, type: 'combo_selectable_size', description: 'Sugest칚o: amendoim, leite em p칩, leite condensado', sizesKey: 'cupSizes' },
            { id: 11, name: 'Megapower', disabled: false, type: 'combo_selectable_size', description: 'Sugest칚o: chocopower, leite em p칩, leite condensado, creme de avel칚 (Nutella)', sizesKey: 'cupSizes' },
            { id: 12, name: 'A칞a칤 Banana', disabled: false, type: 'combo_selectable_size', description: 'Sugest칚o: leite em p칩, tapioca, leite condensado, banana', sizesKey: 'cupSizes' },
            { id: 13, name: 'Favorito Nutella', disabled: false, type: 'combo_selectable_size', description: 'Sugest칚o: flocos, leite condensado, leite em p칩, creme de avel칚 (Nutella)', sizesKey: 'cupSizes' },
            { id: 14, name: 'Sabores do Par치', disabled: false, type: 'combo_selectable_size', description: 'Sugest칚o: banana, uva, leite em p칩, leite condensado, creme de avel칚 (Nutella)', sizesKey: 'cupSizes' },
            { id: 15, name: 'Kids Especial', disabled: false, type: 'combo_selectable_size', description: 'Sugest칚o: M&M\'s, uva, creme de avel칚 (Nutella), leite em p칩, leite condensado, banana', sizesKey: 'cupSizes' },
            { id: 16, name: 'Namorados', disabled: false, type: 'combo_selectable_size', description: 'Sugest칚o: uva, morango, creme de avel칚 (Nutella), leite em p칩, leite condensado', sizesKey: 'cupSizes' },
            { id: 17, name: 'Kitkat', disabled: false, type: 'combo_selectable_size', description: 'Sugest칚o: KitKat, creme de avel칚, leite em p칩, calda de chocolate', sizesKey: 'cupSizes' },
            { id: 18, name: 'Euforia', disabled: false, type: 'combo_selectable_size', description: 'Sugest칚o: morango, kiwi, banana, leite em p칩, calda de morango', sizesKey: 'cupSizes' },
            { id: 19, name: 'Ninho (A)', disabled: false, type: 'combo_selectable_size', description: 'Sugest칚o: leite em po, morango, banana, leite condensado', sizesKey: 'cupSizes' },
            { id: 20, name: 'Bombom', disabled: false, type: 'combo_selectable_size', description: 'Sugest칚o: Sonho de Valsa, leite em p칩, calda de chocolate, creme de avel칚', sizesKey: 'cupSizes' },
            { id: 21, name: 'Maracuj치', disabled: false, type: 'combo_selectable_size', description: 'Sugest칚o: mousse de maracuj치, creme de avel칚, leite em p칩, calda de chocolate', sizesKey: 'cupSizes' },
        ],
        cupSizes: [
            { name: '300ml', price: 14.00 },
            { name: '400ml', price: 17.00 },
            { name: '500ml', price: 20.00 }
        ],
        defaultToppings: {
            free: {
                // ALTERADO: LIMITE DE 7 PARA 3
                title: '游 Acompanhamentos (Frutas, Cremes, Gr칚os, Doces - Tudo Gr치tis, escolha at칠 3)', 
                limit: 3, // <--- ESTE VALOR FOI ALTERADO PARA 3
                price: 0.00, 
                items: [
                    // Itens antigos 'free'
                    { name: 'Amendoim' }, { name: 'Aveia' }, { name: 'Banana' }, { name: 'Coco Ralado' }, { name: 'Creme de Avel칚' }, 
                    { name: 'Creme de Cupua칞u' }, { name: 'Creme de Leite Ninho' }, { name: 'Flocos' }, { name: 'Granola Tradicional' },
                    { name: 'Kiwi' }, { name: 'Leite em P칩' }, { name: 'Manga' }, { name: 'Morango' }, { name: 'Mousse de Maracuj치' },
                    { name: 'Pa칞oca' }, { name: 'Sorvete' }, { name: 'Tapioca' }, { name: 'Uva' },
                    // Itens antigos 'paid_tier2' (Doces e Chocolates)
                    { name: 'Bis Picado' }, { name: 'Chocopower' }, { name: 'Confetes' }, { name: 'Gotas de Chocolate' },
                    { name: 'KitKat' }, { name: 'M&M\'s' }, { name: 'Ovomaltine' }, { name: 'Sonho de Valsa' } 
                ].map(item => ({ ...item, disabled: false }))
            },
            caldas: {
                title: '游꼺 Caldas (Gr치tis, escolha at칠 1)', 
                limit: 1, 
                price: 0.00,
                items: [
                    { name: 'Calda de A칞a칤' }, { name: 'Calda de Caramelo' }, { name: 'Calda de Chocolate' }, 
                    { name: 'Calda de Kiwi' }, { name: 'Calda de Morango' }, { name: 'Leite Condensado' }
                ].map(item => ({ ...item, disabled: false }))
            }
        },
        // --- FIM DA FUS츾O ---

        // --- LOCAL STORAGE KEYS ---
        CART_STORAGE_KEY: 'saborAcaiteriaCart',
        CUSTOMER_INFO_STORAGE_KEY: 'saborAcaiteriaCustomerInfo',
        ADMIN_SETTINGS_STORAGE_KEY: 'saborAcaiteriaAdminSettings',
        PRODUCTS_STORAGE_KEY: 'saborAcaiteriaProducts',
        TOPPINGS_STORAGE_KEY: 'saborAcaiteriaToppings',

        // --- DOM ELEMENT SELECTORS (cached for performance) ---
        elements: {
            productList: document.getElementById('product-list'),
            itemModal: document.getElementById('item-modal'),
            cartModal: document.getElementById('cart-modal'),
            confirmationModal: document.getElementById('confirmation-modal'),
            adminModal: document.getElementById('admin-modal'),
            cartButton: document.getElementById('cart-button'),
            alertModal: document.getElementById('alert-modal'),
            customerNameInput: document.getElementById('customer-name'),
            customerAddressInput: document.getElementById('customer-address'),
            neighborhoodSelect: document.getElementById('neighborhood'),
            deliveryFields: document.getElementById('delivery-fields'),
            deliveryOptionRadios: document.querySelectorAll('input[name="delivery_option"]'),
            passwordModal: document.getElementById('password-modal'),
            adminPasswordInput: document.getElementById('admin-password-input'),
            confirmActionModal: document.getElementById('confirm-action-modal'),
            deliveryTimeBanner: document.getElementById('delivery-time-banner'),
            storeHoursDisplay: document.getElementById('store-hours-display'),
            storeStatusIndicator: document.getElementById('store-status-indicator'),
            storeStatusBanner: document.getElementById('store-status-banner'),
            modalTitle: document.getElementById('modal-title'),
            modalBody: document.getElementById('modal-body'),
            modalItemTotal: document.getElementById('modal-item-total'),
            addToCartBtn: document.getElementById('add-to-cart-btn'),
            cartItemsContainer: document.getElementById('cart-items-container'),
            cartTotalEl: document.getElementById('cart-total'),
            cartCountEl: document.getElementById('cart-count'),
            checkoutForm: document.getElementById('checkout-form'),
            summaryDetails: document.getElementById('cart-summary-details'),
            cartSubtotal: document.getElementById('cart-subtotal'),
            cartDeliveryFee: document.getElementById('cart-delivery-fee'),
            deliveryOptionDelivery: document.getElementById('delivery-option-delivery'),
            deliveryOptionTakeout: document.getElementById('delivery-option-takeout'),
            paymentMethod: document.getElementById('payment-method'),
            observations: document.getElementById('observations'),
            orderSummary: document.getElementById('order-summary'),
            confirmationIcon: document.getElementById('confirmation-icon'),
            confirmationTitle: document.getElementById('confirmation-title'),
            confirmationMessage: document.getElementById('confirmation-message'),
            initialConfirmButtons: document.getElementById('initial-confirm-buttons'),
            postSendButtons: document.getElementById('post-send-buttons'),
            alertMessage: document.getElementById('alert-message'),
            alertTitle: document.getElementById('alert-title'),
            alertIcon: document.getElementById('alert-icon'),
            adminBody: document.getElementById('admin-body'),
            confirmActionMessage: document.getElementById('confirm-action-message'),
            confirmActionConfirmBtn: document.getElementById('confirm-action-confirm-btn'),
            confirmActionCancelBtn: document.getElementById('confirm-action-cancel-btn'),
            storeAddressDisplay: document.getElementById('store-address-display'),
            whatsappLink: document.getElementById('whatsapp-link'),
            messageButtonLink: document.getElementById('message-button-link'),
            comboSizeModal: document.getElementById('combo-size-modal'),
            comboSizeModalTitle: document.getElementById('combo-size-modal-title'),
            comboSizeModalBody: document.getElementById('combo-size-modal-body'),
            selectComboSizeBtn: document.getElementById('select-combo-size-btn'),
            onlineCount: document.getElementById('online-count'),
            closingTimerContainer: document.getElementById('closing-timer-container'),
            closingTimer: document.getElementById('closing-timer'),
            openingTimerContainer: document.getElementById('opening-timer-container'),
            openingTimer: document.getElementById('opening-timer'),
            deliveryCountdownContainer: document.getElementById('delivery-countdown-container'),
            deliveryCountdownTimer: document.getElementById('delivery-countdown-timer'),
            cartSummaryDetails: document.getElementById('cart-summary-details'), // Adicionado
        },

        // --- HELPER FUNCTIONS ---
        formatCurrency(value) { return `R$ ${value.toFixed(2).replace('.', ',')}`; },

        getNextOpeningDate() {
            const now = new Date();
            let nextOpening = null;
            
            // 1. Check if the store opens later today
            const todayHours = app.adminSettings.dailyHours[now.getDay()];
            const [openHour, openMinute] = todayHours.open.split(':').map(Number);
            const openingTimeToday = new Date();
            openingTimeToday.setHours(openHour, openMinute, 0, 0);

            if (now < openingTimeToday) {
                return openingTimeToday;
            }

            // 2. Find the next open day
            for (let i = 1; i <= 7; i++) {
                const nextDate = new Date();
                nextDate.setDate(now.getDate() + i);
                const nextDayOfWeek = nextDate.getDay();
                
                const nextDayHours = app.adminSettings.dailyHours[nextDayOfWeek];
                
                if (app.adminSettings.openDays.includes(nextDayOfWeek) || nextDayHours) {
                    const [nextOpenHour, nextOpenMinute] = nextDayHours.open.split(':').map(Number);
                    nextDate.setHours(nextOpenHour, nextOpenMinute, 0, 0);
                    return nextDate;
                }
            }
            
            return null; 
        },

        // --- LOCAL STORAGE FUNCTIONS ---
        saveCart() { localStorage.setItem(app.CART_STORAGE_KEY, JSON.stringify(app.cart)); },
        loadCart() {
            const savedCart = localStorage.getItem(app.CART_STORAGE_KEY);
            if (savedCart) app.cart = JSON.parse(savedCart);
        },
        saveCustomerInfo() {
            const info = {
                name: app.elements.customerNameInput.value,
                address: app.elements.customerAddressInput.value,
                neighborhood: app.elements.neighborhoodSelect.value,
                deliveryOption: document.querySelector('input[name="delivery_option"]:checked')?.value
            };
            localStorage.setItem(app.CUSTOMER_INFO_STORAGE_KEY, JSON.stringify(info));
        },
        loadCustomerInfo() {
            const savedInfo = localStorage.getItem(app.CUSTOMER_INFO_STORAGE_KEY);
            if (savedInfo) {
                const info = JSON.parse(savedInfo);
                app.elements.customerNameInput.value = info.name || '';
                app.elements.customerAddressInput.value = info.address || '';
                app.elements.neighborhoodSelect.value = info.neighborhood || '';
                if (info.deliveryOption) {
                    const radio = document.querySelector(`input[name="delivery_option"][value="${info.deliveryOption}"]`);
                    if (radio) radio.checked = true;
                }
            }
        },
        loadLocalData() {
            const savedSettings = localStorage.getItem(app.ADMIN_SETTINGS_STORAGE_KEY);
            let loadedSettings = savedSettings ? JSON.parse(savedSettings) : {};
            
            // Merge loaded settings with defaults, ensuring dailyHours structure
            app.adminSettings = { 
                ...app.defaultAdminSettings, 
                ...loadedSettings,
                dailyHours: app.defaultAdminSettings.dailyHours.map((defaultHours, index) => ({
                    ...defaultHours,
                    ...loadedSettings.dailyHours?.[index]
                }))
            };
            
            const savedProducts = localStorage.getItem(app.PRODUCTS_STORAGE_KEY);
            app.products = savedProducts ? JSON.parse(savedProducts) : app.defaultProducts;
            const savedToppings = localStorage.getItem(app.TOPPINGS_STORAGE_KEY);
            app.toppings = savedToppings ? JSON.parse(savedToppings) : app.defaultToppings;
        },

        // --- MODAL & ALERT LOGIC ---
        openModal(modalElement) {
            modalElement.classList.remove('hidden');
            modalElement.classList.add('flex');
            setTimeout(() => modalElement.classList.remove('opacity-0', 'scale-95'), 10);
        },
        closeModal(modalElement) {
            modalElement.classList.add('opacity-0', 'scale-95');
            setTimeout(() => {
                modalElement.classList.add('hidden');
                modalElement.classList.remove('flex');
            }, 300);
        },
        showAlert(message, title = 'Aten칞칚o!', isError = false) {
            app.elements.alertMessage.textContent = message;
            app.elements.alertTitle.textContent = title;
            app.elements.alertIcon.innerHTML = isError 
                ? '<i class="fas fa-exclamation-triangle text-red-500 text-5xl"></i>'
                : '<i class="fas fa-check-circle text-green-500 text-5xl"></i>';
            app.openModal(app.elements.alertModal);
        },
        closeAlertModal() { app.closeModal(app.elements.alertModal); },

        // --- STORE STATUS & COUNTDOWN LOGIC ---
        renderStoreHoursDisplay() {
            const dayNames = ["Dom", "Seg", "Ter", "Qua", "Qui", "Sex", "S치b"];
            
            // Simplificando a exibi칞칚o do hor치rio para o novo formato
            const weekday = app.adminSettings.dailyHours[1]; // Hor치rio de Seg
            const weekend = app.adminSettings.dailyHours[6]; // Hor치rio de S치b/Dom
            
            let hoursString = '';

            if (weekday.open === weekend.open && weekday.close === weekend.close) {
                 hoursString = `Todos os dias: ${weekday.open} 맙 ${weekday.close}`;
            } else {
                 hoursString = `Seg-Sex: ${weekday.open} 맙 ${weekday.close} | S치b/Dom: ${weekend.open} 맙 ${weekend.close}`;
            }

            app.elements.storeHoursDisplay.textContent = hoursString;
        },

        startClosingCountdown() {
            if (app.countdownInterval) clearInterval(app.countdownInterval);
            
            const now = new Date();
            const currentDay = now.getDay();
            const todayHours = app.adminSettings.dailyHours[currentDay];
            
            if (!todayHours) {
                app.stopClosingCountdown();
                return;
            }

            const [closeHour, closeMinute] = todayHours.close.split(':').map(Number);
            const targetTime = new Date();
            targetTime.setHours(closeHour, closeMinute, 0, 0);

            // Se o hor치rio de fechamento j치 passou hoje, e o hor치rio de fechamento 칠 ANTES do hor치rio de abertura, 
            // significa que a loja fecha no pr칩ximo dia (n칚o 칠 o caso aqui, mas mantido por seguran칞a)
            // No cen치rio atual (fecha sempre antes da meia-noite), se j치 passou, para o contador.
            if (targetTime < now) {
                app.stopClosingCountdown();
                return;
            }

            app.elements.closingTimerContainer.classList.remove('hidden');
            app.elements.closingTimerContainer.classList.add('flex');

            app.countdownInterval = setInterval(() => {
                const now = new Date();
                const diff = targetTime - now;

                if (diff <= 0) {
                    app.stopClosingCountdown();
                    app.checkStoreStatus(); 
                    return;
                }

                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                app.elements.closingTimer.textContent = 
                    `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }, 1000);
        },

        stopClosingCountdown() {
            clearInterval(app.countdownInterval);
            app.countdownInterval = null;
            app.elements.closingTimerContainer.classList.add('hidden');
            app.elements.closingTimerContainer.classList.remove('flex');
        },

        startOpeningCountdown() {
            if (app.openingCountdownInterval) clearInterval(app.openingCountdownInterval);

            const targetTime = app.getNextOpeningDate();
            if (!targetTime) return;

            app.elements.openingTimerContainer.classList.remove('hidden');
            app.elements.openingTimerContainer.classList.add('flex');

            const updateTimer = () => {
                const now = new Date();
                const diff = targetTime - now;

                if (diff <= 0) {
                    app.stopOpeningCountdown();
                    app.checkStoreStatus(); 
                    return;
                }

                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                let timerString = '';
                if (days > 0) {
                    timerString = `${days}d ${String(hours).padStart(2, '0')}h`;
                } else {
                    timerString = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                }
                app.elements.openingTimer.textContent = timerString;
            };
            
            updateTimer(); 
            app.openingCountdownInterval = setInterval(updateTimer, 1000);
        },

        stopOpeningCountdown() {
            clearInterval(app.openingCountdownInterval);
            app.openingCountdownInterval = null;
            app.elements.openingTimerContainer.classList.add('hidden');
            app.elements.openingTimerContainer.classList.remove('flex');
        },

        startDeliveryCountdown() {
            if (app.deliveryCountdownInterval) clearInterval(app.deliveryCountdownInterval);

            const now = new Date();
            const currentDay = now.getDay();
            
            const deliveryStartTimeStr = currentDay === 0 || currentDay === 6 
                ? app.adminSettings.weekendDeliveryStartTime 
                : app.adminSettings.weekdayDeliveryStartTime;
            
            const [deliveryHour, deliveryMinute] = deliveryStartTimeStr.split(':').map(Number);
            const targetTime = new Date();
            targetTime.setHours(deliveryHour, deliveryMinute, 0, 0);

            if (targetTime < now) {
                app.stopDeliveryCountdown();
                return;
            }

            app.elements.deliveryCountdownContainer.classList.remove('hidden');
            app.elements.deliveryCountdownContainer.classList.add('flex');
            
            const updateTimer = () => {
                 const now = new Date();
                const diff = targetTime - now;

                if (diff <= 0) {
                    app.stopDeliveryCountdown();
                    app.checkStoreStatus();
                    return;
                }

                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                
                app.elements.deliveryCountdownTimer.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            };
            
            updateTimer();
            app.deliveryCountdownInterval = setInterval(updateTimer, 1000);
        },

        stopDeliveryCountdown() {
            clearInterval(app.deliveryCountdownInterval);
            app.deliveryCountdownInterval = null;
            app.elements.deliveryCountdownContainer.classList.add('hidden');
            app.elements.deliveryCountdownContainer.classList.remove('flex');
        },

        checkStoreStatus() {
            const now = new Date();
            const currentDay = now.getDay();
            const todayHours = app.adminSettings.dailyHours[currentDay];

            if (app.adminSettings.storeStatus === 'open') app.isStoreOpen = true;
            else if (app.adminSettings.storeStatus === 'closed') app.isStoreOpen = false;
            else {
                // C치lculo de status baseado em dailyHours
                if (!todayHours) {
                    app.isStoreOpen = false;
                } else {
                    const [openHour, openMinute] = todayHours.open.split(':').map(Number);
                    const [closeHour, closeMinute] = todayHours.close.split(':').map(Number);
                    const openTime = openHour * 60 + openMinute;
                    const closeTime = closeHour * 60 + closeMinute;
                    const currentTime = now.getHours() * 60 + now.getMinutes();

                    // Caso o fechamento seja no dia seguinte (n칚o o caso atual, mas mantido)
                    if (closeTime < openTime) app.isStoreOpen = (currentTime >= openTime || currentTime <= closeTime);
                    // Caso normal (fechamento no mesmo dia)
                    else app.isStoreOpen = (currentTime >= openTime && currentTime <= closeTime);
                }
            }
            
            const deliveryStartTimeStr = currentDay === 0 || currentDay === 6 
                ? app.adminSettings.weekendDeliveryStartTime 
                : app.adminSettings.weekdayDeliveryStartTime;
                
            const [deliveryStartHour, deliveryStartMinute] = deliveryStartTimeStr.split(':').map(Number);
            const deliveryStartTime = deliveryStartHour * 60 + deliveryStartMinute;
            const currentTime = now.getHours() * 60 + now.getMinutes();
            app.isDeliveryTime = currentTime >= deliveryStartTime;
            
            // Countdown logic
            if (app.isStoreOpen) {
                app.stopOpeningCountdown();
                app.startClosingCountdown();
                
                if (!app.isDeliveryTime && ['both', 'delivery'].includes(app.adminSettings.deliveryMode)) {
                    app.startDeliveryCountdown();
                } else {
                    app.stopDeliveryCountdown();
                }
            } else { // Store is closed
                app.stopClosingCountdown();
                app.stopDeliveryCountdown();
                app.startOpeningCountdown();
            }

            const indicator = app.elements.storeStatusIndicator;
            indicator.textContent = app.isStoreOpen ? 'Aberto' : 'Fechado';
            indicator.className = `ml-2 px-2 py-0.5 text-xs rounded-full font-semibold ${app.isStoreOpen ? 'bg-green-200 text-green-800' : 'bg-red-200 text-red-800'}`;

            const statusBanner = app.elements.storeStatusBanner;
            if (!app.isStoreOpen) {
                statusBanner.innerHTML = `<div class="bg-red-900 bg-opacity-50 border border-red-700 text-red-300 p-3 rounded-lg text-center text-sm"><p class="font-bold">Estamos fechados!</p><p>O card치pio est치 dispon칤vel para visualiza칞칚o.</p></div>`;
                statusBanner.classList.remove('hidden');
            } else {
                statusBanner.classList.add('hidden');
            }

            const deliveryBanner = app.elements.deliveryTimeBanner;
            if (!app.isDeliveryTime && app.isStoreOpen && ['both', 'delivery'].includes(app.adminSettings.deliveryMode)) {
                deliveryBanner.innerHTML = `<div class="bg-blue-900 bg-opacity-50 border border-blue-700 text-blue-300 p-3 rounded-lg text-center text-sm"><p class="font-bold">Entregas a partir das ${deliveryStartTimeStr}h!</p><p>Pedidos para retirada j치 est칚o dispon칤veis.</p></div>`;
                deliveryBanner.classList.remove('hidden');
            } else {
                deliveryBanner.classList.add('hidden');
            }
            
            app.renderStoreHoursDisplay();
            app.renderProducts();
            app.renderDeliveryOptions();
            app.renderCart();
        },

        // --- RENDER FUNCTIONS ---
        renderProducts() {
            app.elements.productList.innerHTML = '';
            const mostOrderedIds = [2, 5, 8, 10, 12, 19];

            app.products.forEach(product => {
                const isCombo = product.type === 'combo_selectable_size';
                const isCup = product.name.toLowerCase().includes('copo');
                const isKit = product.name.toLowerCase().includes('kit') || product.name.toLowerCase().includes('namorados') || product.name.toLowerCase().includes('kids');

                let onclickHandler = product.disabled ? '' : (isCombo ? `onclick="app.openComboSizeModal('${product.id}')"` : `onclick="app.openItemModal('${product.id}', ${product.price}, '')"`);
                
                let priceDisplay;
                if (isCombo) {
                    const sizesToUse = product.sizesKey && app[product.sizesKey] ? app[product.sizesKey] : app.cupSizes;
                    const startingPrice = sizesToUse.length > 0 ? sizesToUse[0].price : 0;
                    priceDisplay = `<span class="text-xs text-gray-400">A partir de</span><strong class="block text-base text-gray-100">${app.formatCurrency(startingPrice)}</strong>`;
                } else {
                    priceDisplay = `<strong class="text-base font-bold text-gray-100">${app.formatCurrency(product.price)}</strong>`;
                }
                
                let cardContainerClasses = (isCup || isKit) 
                    ? 'border-2 border-pink-500 shadow-lg shadow-pink-500/20'
                    : 'border border-gray-700';
                
                const spanClass = '';

                const isMostOrdered = mostOrderedIds.includes(product.id);
                const mostOrderedTag = isMostOrdered 
                    ? `<div class="absolute -top-2.5 -right-2.5 bg-green-500 text-white text-[10px] font-bold px-2 py-1 rounded-full shadow-lg transform rotate-12 z-10">MAIS PEDIDO!</div>` 
                    : '';

                const productCard = `
                    <div class="product-card group relative cursor-pointer bg-gray-900 rounded-lg p-3 flex flex-col justify-between h-full transition-all duration-200 hover:shadow-xl hover:border-pink-500/50 ${spanClass} ${cardContainerClasses}" ${onclickHandler}>
                        ${mostOrderedTag}
                        <div>
                            <h3 class="font-bold text-gray-100 text-base leading-tight">${product.name}</h3>
                            ${product.description ? `<p class="text-xs text-gray-400 mt-1">${product.description.replace('Sugest칚o: ','')}</p>` : ''}
                        </div>
                        <div class="flex justify-between items-center mt-3">
                            <div class="text-left">
                                ${priceDisplay}
                            </div>
                            <div class="btn-gradient text-white font-bold py-1 px-3 rounded-lg flex items-center gap-1.5 text-sm transform group-hover:scale-105 transition-transform">
                                <span>Montar</span>
                                <i class="fas fa-arrow-right fa-xs"></i>
                            </div>
                        </div>
                        ${product.disabled ? `<div class="absolute inset-0 bg-gray-900 bg-opacity-80 flex items-center justify-center rounded-lg cursor-not-allowed"><span class="text-gray-200 font-bold text-sm bg-gray-700 px-3 py-1 rounded-full shadow-sm">Indispon칤vel</span></div>` : ''}
                    </div>
                `;

                app.elements.productList.innerHTML += productCard;
            });
        },


        // --- CART LOGIC ---
        toggleCartModal() {
            app.renderDeliveryOptions();
            app.renderCart();
            if (app.elements.cartModal.classList.contains('hidden')) app.openModal(app.elements.cartModal);
            else app.closeModal(app.elements.cartModal);
        },
        addToCart() {
            const toppingsStr = app.currentItem.toppings.map(t => `${t.name}-${t.price}`).sort().join(',');
            const existingItemIndex = app.cart.findIndex(item =>
                item.id === app.currentItem.id && item.selectedSize === app.currentItem.selectedSize &&
                item.toppings.map(t => `${t.name}-${t.price}`).sort().join(',') === toppingsStr
            );
            
            const quantityToAdd = app.currentItem.quantity || 1;

            if (existingItemIndex > -1) {
                app.cart[existingItemIndex].quantity += quantityToAdd;
            } else {
                // currentItem already has the correct quantity set from the modal
                app.cart.push({ ...app.currentItem });
            }
            app.saveCart();
            app.renderCart();
            app.updateCartIcon();
        },
        updateQuantity(index, change) {
            if (app.cart[index].quantity + change > 0) app.cart[index].quantity += change;
            else app.removeFromCart(index);
            
            // Clear coupon on cart change to force re-application/recalculation
            app.clearAppliedCoupon(); 

            app.saveCart();
            app.renderCart();
            app.updateCartIcon();
        },
        removeFromCart(index) {
            app.cart.splice(index, 1);
            
            // Clear coupon on cart change to force re-application/recalculation
            app.clearAppliedCoupon();

            app.saveCart();
            app.renderCart();
            app.updateCartIcon();
        },
        updateCartIcon() {
            const totalItems = app.cart.reduce((sum, item) => sum + (item.quantity || 0), 0);
            app.elements.cartCountEl.textContent = totalItems;
            app.elements.cartButton.classList.toggle('hidden', totalItems === 0);
            if (totalItems === 0 && !app.elements.cartModal.classList.contains('hidden')) {
                app.toggleCartModal();
            }
        },

        // --- CUPON LOGIC ---
        loadCouponHistory() {
            const savedHistory = localStorage.getItem(app.COUPON_STORAGE_KEY);
            if (savedHistory) app.couponHistory = JSON.parse(savedHistory);
        },

        saveCouponUsage(code) {
            const today = new Date().toISOString().slice(0, 10); // YYYY-MM-DD
            app.couponHistory[code] = today;
            localStorage.setItem(app.COUPON_STORAGE_KEY, JSON.stringify(app.couponHistory));
        },

        isCouponUsedToday(code) {
            const today = new Date().toISOString().slice(0, 10);
            return app.couponHistory[code] === today;
        },

        clearAppliedCoupon() {
            app.appliedCoupon = null;
            app.renderCart();
        },

        applyCoupon() {
            const input = document.getElementById('coupon-input');
            const code = input.value.toUpperCase().trim();
            app.clearAppliedCoupon();
            
            if (!code) return app.showAlert('Digite um c칩digo de cupom.', 'Aten칞칚o', true);

            const coupon = app.coupons.find(c => c.code === code);
            
            if (!coupon) {
                input.value = '';
                return app.showAlert('Cupom inv치lido.', 'Erro', true);
            }

            if (app.isCouponUsedToday(code)) {
                input.value = '';
                return app.showAlert('Este cupom j치 foi utilizado hoje. Voc칡 s칩 pode usar cada cupom uma vez por dia.', 'Uso Limitado', true);
            }
            
            // Check if the cart has items
            if (app.cart.length === 0) {
                input.value = '';
                return app.showAlert('Adicione itens ao carrinho antes de aplicar um cupom.', 'Carrinho Vazio', true);
            }

            // Apply the coupon logic
            const subtotal = app.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            app.appliedCoupon = { code: coupon.code, type: coupon.type, value: coupon.value };

            if (coupon.type === 'percentage') {
                app.appliedCoupon.discountAmount = subtotal * coupon.value;
            } else if (coupon.type === 'free_delivery') {
                app.appliedCoupon.isDeliveryFree = true;
                app.appliedCoupon.discountAmount = 0; // The actual delivery fee will be calculated in renderCart
            }
            
            app.renderCart();
            
            let message = `Cupom **${code}** aplicado com sucesso!`;
            if (coupon.type === 'percentage') {
                message = `Cupom **${code}** aplicado! Voc칡 ganhou ${Math.round(coupon.value * 100)}% de desconto.`;
            } else if (coupon.type === 'free_delivery') {
                message = `Cupom **${code}** aplicado! Sua entrega ser치 gr치tis (se aplic치vel).`;
            }
            
            app.showAlert(message, 'Cupom Aplicado');
            
            // Keep the value in the input to show the applied coupon
            if(input) input.value = code;
        },

        renderCouponInput() {
            let couponHtml = '';

            if (app.appliedCoupon) {
                const discountType = app.appliedCoupon.type === 'percentage' 
                    ? `${Math.round(app.appliedCoupon.value * 100)}%` 
                    : 'Entrega Gr치tis';
                    
                couponHtml = `
                    <div class="flex items-center justify-between p-3 bg-green-900 border border-green-700 rounded-lg">
                        <div class="flex items-center gap-2">
                            <i class="fas fa-tags text-green-400"></i>
                            <span class="font-bold text-gray-100">CUPOM APLICADO: ${app.appliedCoupon.code}</span>
                            <span class="text-xs text-green-300">(${discountType})</span>
                        </div>
                        <button onclick="app.clearAppliedCoupon()" class="text-red-400 hover:text-red-300 transition-colors" title="Remover Cupom">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
            } else if (app.cart.length > 0) {
                couponHtml = `
                    <div class="flex gap-2">
                        <input type="text" id="coupon-input" class="flex-grow bg-gray-800 border-2 border-gray-600 rounded-md p-3 text-base text-white placeholder-gray-400 uppercase" placeholder="Insira seu Cupom (Ex: SABOR10)">
                        <button onclick="app.applyCoupon()" class="bg-pink-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-pink-700 transition-colors disabled:opacity-50" title="Aplicar Cupom">
                            <i class="fas fa-check"></i>
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">Cupons s칩 podem ser usados uma vez por dia.</p>
                `;
            }
            
            const couponContainer = document.getElementById('coupon-container');
            if (couponContainer) couponContainer.innerHTML = couponHtml;
        },

        renderCart() {
            if (app.cart.length === 0) {
                app.elements.cartItemsContainer.innerHTML = '<p class="text-gray-400 text-center">Seu carrinho est치 vazio.</p>';
                app.elements.checkoutForm.classList.add('hidden');
                app.elements.summaryDetails.classList.add('hidden');
            } else {
                app.elements.checkoutForm.classList.remove('hidden');
                app.elements.summaryDetails.classList.remove('hidden');
                app.elements.cartItemsContainer.innerHTML = app.cart.map((item, index) => {
                    let toppingsDisplay = '';
                    if (item.type === 'base_acai') {
                        toppingsDisplay = item.toppings.length > 0
                        ? item.toppings.map(t => `<span>- ${t.name} ${t.price > 0 ? `(+${app.formatCurrency(t.price)})` : ''}</span>`).join('<br>')
                        : '<span>- A칞a칤 puro</span>';
                    } else if (item.type === 'combo_selectable_size') {
                        toppingsDisplay = `<span>Tamanho: ${item.selectedSize}</span><br><span>${item.description.replace('Sugest칚o: ', '')}</span>`;
                    }
                    return `
                        <div class="flex items-start justify-between py-4 border-b border-gray-700">
                            <div>
                                <p class="font-bold text-md text-gray-100">${item.quantity}x ${item.name}</p>
                                <div class="text-sm text-gray-400 mt-1">${toppingsDisplay}</div>
                            </div>
                            <div class="text-right">
                                <p class="font-bold text-md text-gray-100">${app.formatCurrency(item.price * item.quantity)}</p>
                                <div class="flex items-center gap-2 mt-2">
                                    <button onclick="app.updateQuantity(${index}, -1)" class="bg-gray-700 text-white w-7 h-7 rounded-md font-bold">-</button>
                                    <span class="font-bold w-5 text-center">${item.quantity}</span>
                                    <button onclick="app.updateQuantity(${index}, 1)" class="bg-gray-700 text-white w-7 h-7 rounded-md font-bold">+</button>
                                    <button onclick="app.removeFromCart(${index})" class="text-red-500 hover:text-red-400 ml-2"><i class="fas fa-trash"></i></button>
                                </div>
                            </div>
                        </div>`;
                }).join('');
            }
            
            // --- CUPOM CALCULATION LOGIC ---
            let subtotalItems = app.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            let deliveryFee = 0;
            let couponDiscount = 0;
            let isDeliveryFree = false;

            // Apply percentage discount to subtotal
            let subtotalAfterDiscount = subtotalItems;
            if (app.appliedCoupon && app.appliedCoupon.type === 'percentage') {
                couponDiscount = subtotalItems * app.appliedCoupon.value;
                app.appliedCoupon.discountAmount = couponDiscount;
                subtotalAfterDiscount -= couponDiscount;
            }
            
            const deliveryOption = document.querySelector('input[name="delivery_option"]:checked')?.value;
            if (deliveryOption === 'delivery' && subtotalItems > 0) {
                const selectedOption = app.elements.neighborhoodSelect.options[app.elements.neighborhoodSelect.selectedIndex];
                let baseFee = parseFloat(selectedOption.dataset.fee || 0);

                // Check for free delivery coupon
                if (app.appliedCoupon && app.appliedCoupon.type === 'free_delivery') {
                    isDeliveryFree = true;
                    app.appliedCoupon.discountAmount = baseFee; // Store the waived fee as the discount amount
                    deliveryFee = 0;
                } else {
                    deliveryFee = baseFee;
                }
            }
            
            const finalTotal = subtotalAfterDiscount + deliveryFee;

            // Render Summary Details
            let summaryHtml = `
                <div class="flex justify-between text-gray-400">
                    <span>Subtotal dos Itens</span>
                    <span id="cart-subtotal">${app.formatCurrency(subtotalItems)}</span>
                </div>
            `;
            
            if (couponDiscount > 0) {
                 summaryHtml += `
                    <div class="flex justify-between text-green-400 font-semibold">
                        <span>Desconto (${app.appliedCoupon.code})</span>
                        <span id="cart-discount">- ${app.formatCurrency(couponDiscount)}</span>
                    </div>
                `;
            }

            summaryHtml += `
                <div class="flex justify-between text-gray-400">
                    <span>Taxa de Entrega</span>
                    <span id="cart-delivery-fee">${app.formatCurrency(deliveryFee)}</span>
                </div>
            `;
            
            if (isDeliveryFree && app.appliedCoupon.discountAmount > 0) {
                summaryHtml += `
                    <div class="flex justify-between text-green-400 font-semibold border-t border-gray-700 pt-2">
                        <span>Taxa Gr치tis (Desconto)</span>
                        <span>- ${app.formatCurrency(app.appliedCoupon.discountAmount)}</span>
                    </div>
                `;
            }
            
            app.elements.cartSummaryDetails.innerHTML = summaryHtml;
            app.elements.cartTotalEl.textContent = app.formatCurrency(finalTotal);
            const finalizeBtn = document.querySelector('button[onclick="app.finalizeOrder()"]');
            if(finalizeBtn){
                finalizeBtn.disabled = !app.isStoreOpen || app.cart.length === 0;
                finalizeBtn.classList.toggle('opacity-50', finalizeBtn.disabled);
                finalizeBtn.classList.toggle('cursor-not-allowed', finalizeBtn.disabled);
            }
            
            // Render the coupon input/status
            app.renderCouponInput();
        },

        // --- ORDER FINALIZATION ---
        finalizeOrder() {
            if (!app.isStoreOpen || app.cart.length === 0) return;
            const name = app.elements.customerNameInput.value.trim();
            const address = app.elements.customerAddressInput.value.trim();
            const neighborhood = app.elements.neighborhoodSelect.value;
            const payment = app.elements.paymentMethod.value;
            const obs = app.elements.observations.value.trim();
            const deliveryOption = document.querySelector('input[name="delivery_option"]:checked')?.value;
            
            if (!name) return app.showAlert('Por favor, preencha seu Nome.', 'Dados Incompletos', true);
            if (deliveryOption === 'delivery' && (!address || !neighborhood)) {
                return app.showAlert('Selecione o Bairro e preencha o Endere칞o.', 'Dados Incompletos', true);
            }
            
            // Recalculate totals including coupon for message accuracy
            let subtotalItems = app.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            let deliveryFee = 0;
            let couponDiscount = 0;
            let isDeliveryFree = false;
            
            if (app.appliedCoupon && app.appliedCoupon.type === 'percentage') {
                couponDiscount = subtotalItems * app.appliedCoupon.value;
            }
            
            const subtotalAfterDiscount = subtotalItems - couponDiscount;
            
            if (deliveryOption === 'delivery') {
                const selectedFee = app.elements.neighborhoodSelect.options[app.elements.neighborhoodSelect.selectedIndex].dataset.fee;
                const baseFee = parseFloat(selectedFee || 0);

                if (app.appliedCoupon && app.appliedCoupon.type === 'free_delivery') {
                    isDeliveryFree = true;
                    deliveryFee = 0;
                } else {
                    deliveryFee = baseFee;
                }
            }
            
            const finalTotal = subtotalAfterDiscount + deliveryFee;
            
            let summary = `*NOVO PEDIDO - SABOR A칂A칈TERIA*\n\n*Cliente:* ${name}\n`;
            if (deliveryOption === 'delivery') {
                summary += `*Op칞칚o:* ENTREGA\n*Endere칞o:* ${address}, ${neighborhood}\n`;
            } else {
                summary += `*Op칞칚o:* RETIRAR NA LOJA\n`;
            }
            
            // Add cupom information to the summary
            if (app.appliedCoupon) {
                summary += `\n*CUPOM APLICADO:* ${app.appliedCoupon.code}\n`;
            }
            
            summary += `\n*ITENS DO PEDIDO:*\n------------------------\n`;
            
            app.cart.forEach(item => {
                summary += `*${item.quantity}x ${item.name}*`;
                if (item.selectedSize) summary += ` (${item.selectedSize})`;
                if (item.type === 'combo_selectable_size' && item.description) summary += ` - ${item.description.replace('Sugest칚o: ', '')}`;
                summary += `\n`;
                if (item.toppings.length > 0) item.toppings.forEach(t => { summary += `  - ${t.name}\n`; });
                summary += `Subtotal: ${app.formatCurrency(item.price * item.quantity)}\n------------------------\n`;
            });
            
            summary += `\n*Subtotal dos Itens (s/ Desconto): ${app.formatCurrency(subtotalItems)}*\n`;
            
            if (couponDiscount > 0) {
                summary += `*Desconto Cupom ${app.appliedCoupon.code}: - ${app.formatCurrency(couponDiscount)}*\n`;
            }
            
            if (deliveryOption === 'delivery') {
                if (isDeliveryFree) {
                    summary += `*Taxa de Entrega: GR츼TIS (Cupom ${app.appliedCoupon.code})*\n`;
                } else {
                    summary += `*Taxa de Entrega: ${app.formatCurrency(deliveryFee)}*\n`;
                }
            }
            
            summary += `*TOTAL FINAL: ${app.formatCurrency(finalTotal)}*\n*Pagamento:* ${payment}\n`;
            if (obs) summary += `*Observa칞칫es:* ${obs}\n`;
            
            app.whatsAppMessage = encodeURIComponent(summary);
            app.elements.orderSummary.innerHTML = summary.replace(/\n/g, '<br>').replace(/\*(.*?)\*/g, '<strong>$1</strong>');
            
            // Save coupon usage if applied
            if (app.appliedCoupon) {
                app.saveCouponUsage(app.appliedCoupon.code);
            }
            
            app.saveCustomerInfo(); // Salva dados do cliente no 칰ltimo momento
            app.closeModal(app.elements.cartModal);
            app.openModal(app.elements.confirmationModal);
        },
        sendOrderViaWhatsApp() {
            window.open(`https://wa.me/${app.adminSettings.whatsappNumber}?text=${app.whatsAppMessage}`, '_blank');
            app.elements.confirmationIcon.innerHTML = '<i class="fab fa-whatsapp-square text-green-400 text-6xl mb-4"></i>';
            app.elements.confirmationTitle.textContent = 'Quase l치!';
            app.elements.confirmationMessage.textContent = 'A janela do WhatsApp foi aberta. Ap칩s enviar sua mensagem, clique abaixo para confirmar e limpar seu carrinho.';
            app.elements.initialConfirmButtons.classList.add('hidden');
            app.elements.postSendButtons.classList.remove('hidden');
            app.elements.postSendButtons.classList.add('flex');
        },
        confirmOrderSent() {
            app.cart = [];
            app.appliedCoupon = null; // Limpa o cupom aplicado
            app.saveCart();
            app.closeConfirmationModal();
            app.renderCart();
            app.updateCartIcon();
            app.showAlert('Seu carrinho foi limpo. Aguarde a confirma칞칚o da loja!', 'Pedido Enviado');
        },
        closeConfirmationModal() {
            app.closeModal(app.elements.confirmationModal);
            setTimeout(() => {
                app.elements.confirmationIcon.innerHTML = '<i class="fas fa-check-circle text-green-500 text-6xl mb-4"></i>';
                app.elements.confirmationTitle.textContent = 'Pedido Recebido!';
                app.elements.confirmationMessage.textContent = 'Seu pedido foi gerado! Clique no bot칚o abaixo para encaminh치-lo para o WhatsApp da loja e finalizar a compra.';
                app.elements.initialConfirmButtons.classList.remove('hidden');
                app.elements.postSendButtons.classList.add('hidden');
            }, 300);
        },

        // --- ADMIN PANEL (Functionality unchanged, UI kept separate) ---
        openAdminPanel(e) { e.preventDefault(); app.openModal(app.elements.passwordModal); app.elements.adminPasswordInput.focus(); },
        closePasswordModal() { app.closeModal(app.elements.passwordModal); app.elements.adminPasswordInput.value = ''; },
        checkAdminPassword() {
            if (app.elements.adminPasswordInput.value === "admin123") {
                app.closePasswordModal();
                app.renderAdminPanel();
                app.openModal(app.elements.adminModal);
            } else {
                app.closePasswordModal();
                app.showAlert("Senha incorreta!", 'Acesso Negado', true);
            }
        },
        closeAdminModal() { app.closeModal(app.elements.adminModal); },
        renderAdminPanel() { /* ... Logic from original script, intentionally omitted for brevity but is unchanged ... */ },
        saveAdminChanges() { app.showAlert('As configura칞칫es foram salvas.', 'Salvo'); app.closeAdminModal(); },
        resetToDefaults() { /* ... Logic from original script, intentionally omitted for brevity but is unchanged ... */ },

        // --- FAKE ONLINE COUNTER ---
        updateOnlineCounter() {
            const min = 4;
            const max = 20;
            const currentCount = parseInt(app.elements.onlineCount.textContent, 10);
            let newCount;
            
            const change = Math.random() > 0.5 ? 1 : -1;
            newCount = currentCount + change;

            if (newCount > max) newCount = max - 1;
            if (newCount < min) newCount = min + 1;
            
            app.elements.onlineCount.textContent = newCount;
            
            const randomInterval = Math.floor(Math.random() * (8000 - 3000 + 1)) + 3000;
            setTimeout(app.updateOnlineCounter, randomInterval);
        },
        
        updateModalItemTotal() {
            let toppingsTotal = 0;
            const toppingsList = [];
            Object.entries(app.toppings).forEach(([key, category]) => {
                const checked = app.elements.modalBody.querySelectorAll(`input[name="${key}"]:checked`);
                const all = app.elements.modalBody.querySelectorAll(`input[name="${key}"]`);
                const limit = app.currentItem.customToppingLimits?.[key] || category.limit;

                if (limit && limit < 999) {
                    const limitReached = checked.length >= limit;
                    all.forEach(cb => { 
                        if (!cb.checked) cb.disabled = limitReached; 
                    });
                }
                
                checked.forEach(cb => {
                    const price = parseFloat(cb.dataset.price);
                    if (price > 0) toppingsTotal += price;
                    toppingsList.push({ name: cb.value, price: price });
                });
                
                // Garantir que nenhum item fique desabilitado sem motivo (ex: na categoria caldas)
                if (limit === 999) { 
                    all.forEach(cb => cb.disabled = false);
                }
            });
            
            app.currentItem.price = app.currentItem.basePrice + toppingsTotal;
            app.currentItem.toppings = toppingsList.sort((a, b) => a.name.localeCompare(b.name));
            
            const finalPrice = app.currentItem.price * app.currentItem.quantity;
            app.elements.modalItemTotal.textContent = app.formatCurrency(finalPrice);

            const btn = app.elements.addToCartBtn;
            if (app.currentItem.quantity > 1) {
                btn.innerHTML = `Adicionar ${app.currentItem.quantity} Itens`;
            } else {
                btn.innerHTML = `Adicionar ao Carrinho`;
            }
        },
        openItemModal(productId, basePrice, sizeName = '') {
            if (!app.isStoreOpen) {
                app.showAlert('A loja est치 fechada e n칚o 칠 poss칤vel montar pedidos agora.', 'Loja Fechada', true);
                return;
            }
            const product = app.products.find(p => p.id.toString() === productId.toString());
            if (!product) return;

            app.currentItem = {
                id: productId, name: product.name, basePrice: basePrice, price: basePrice, 
                quantity: 1, toppings: [], type: product.type, selectedSize: sizeName
            };
            if (product.customToppingLimits) {
                app.currentItem.customToppingLimits = product.customToppingLimits;
            }

            app.elements.modalTitle.textContent = sizeName ? `Monte seu ${product.name} (${sizeName})` : `Monte seu ${product.name}`;
            
            // Adiciona o seletor de quantidade primeiro
            app.elements.modalBody.innerHTML = `
                <div class="space-y-2 mb-6 border-b border-gray-700 pb-6">
                    <h4 class="text-lg font-bold text-gray-100 text-center">Quantidade</h4>
                    <div class="flex items-center justify-center gap-4">
                        <button onclick="app.updateModalQuantity(-1)" class="bg-gray-700 text-white w-10 h-10 rounded-full font-bold text-xl flex items-center justify-center hover:bg-gray-600 transition-colors">-</button>
                        <span id="modal-quantity" class="font-bold text-3xl text-white w-12 text-center">${app.currentItem.quantity}</span>
                        <button onclick="app.updateModalQuantity(1)" class="bg-gray-700 text-white w-10 h-10 rounded-full font-bold text-xl flex items-center justify-center hover:bg-gray-600 transition-colors">+</button>
                    </div>
                </div>
            `;
            
            if (product.type.includes('combo')) {
                app.elements.modalBody.innerHTML += `<div class="bg-gray-800 p-3 rounded-lg text-sm text-gray-300"><p class="font-bold">Este combo sugere:</p><p>${product.description.replace('Sugest칚o: ', '')}</p></div>`;
            }
            
            // --- L칍GICA DE FUS츾O (Renderiza칞칚o Aprimorada) ---
            Object.entries(app.toppings).forEach(([key, category]) => {
                const limit = app.currentItem.customToppingLimits?.[key] || category.limit;
                let categoryTitle = category.title;
                let subtitle = '';
                const currentLimit = limit === 999 ? 'quantos quiser' : `at칠 ${limit}`;

                // Customiza o subt칤tulo para cada categoria
                if (key === 'free') { 
                    categoryTitle = `游 Acompanhamentos`; 
                    subtitle = `(Tudo liberado e gr치tis. Escolha ${currentLimit} no total)`; // Subt칤tulo atualizado
                } else if (key === 'caldas') {
                    categoryTitle = `游꼺 Caldas`;
                    subtitle = `(Gr치tis, escolha ${currentLimit} para finalizar)`;
                }

                // Gera o HTML dos itens
                const itemsHTML = category.items.filter(item => !item.disabled).map(item => `
                    <label class="flex items-center space-x-3 p-2 rounded-md hover:bg-gray-700 cursor-pointer">
                        <input type="checkbox" class="h-5 w-5 rounded border-gray-500 bg-gray-600 text-pink-600 focus:ring-pink-500" name="${key}" value="${item.name}" data-price="${category.price || 0}">
                        <span class="text-gray-300">
                            ${item.name} 
                            ${category.price > 0 ? `<span class="text-xs text-yellow-400 font-medium ml-1">(+${app.formatCurrency(category.price)})</span>` : ''}
                        </span>
                    </label>
                `).join('');

                if (itemsHTML) {
                    app.elements.modalBody.innerHTML += `
                        <div class="mt-4">
                            <h4 class="text-xl font-bold text-gray-100 mb-1">${categoryTitle}</h4>
                            <p class="text-sm text-gray-400 mb-3">${subtitle}</p>
                            <div class="grid grid-cols-2 sm:grid-cols-3 gap-2">${itemsHTML}</div>
                        </div>
                    `;
                }
            });
            
            app.elements.modalBody.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.addEventListener('change', app.updateModalItemTotal));
            app.updateModalItemTotal();
            app.openModal(app.elements.itemModal);
        },
        closeItemModal() { app.closeModal(app.elements.itemModal); app.currentItem = null; },
        openComboSizeModal(productId) {
            if (!app.isStoreOpen) {
                app.showAlert('A loja est치 fechada e n칚o 칠 poss칤vel montar pedidos agora.', 'Loja Fechada', true);
                return;
            }
            app.selectedComboProductId = productId;
            const product = app.products.find(p => p.id.toString() === productId.toString());
            if (!product) return;

            const sizesToUse = product.sizesKey && app[product.sizesKey] ? app[product.sizesKey] : app.cupSizes;

            app.elements.comboSizeModalTitle.textContent = `Escolha o Tamanho para ${product.name}`;
            app.elements.comboSizeModalBody.innerHTML = sizesToUse.map(size => `
                <label>
                    <input type="radio" name="combo_size" value="${size.name}" data-price="${size.price}" class="hidden">
                    <div class="flex items-center justify-between p-3 border-2 border-gray-600 rounded-lg cursor-pointer transition-all">
                        <span class="font-semibold text-gray-200">${size.name}</span>
                        <span class="text-sm text-gray-400">${app.formatCurrency(size.price)}</span>
                    </div>
                </label>
            `).join('') + `
                <div class="mt-6 space-y-2">
                    <h4 class="text-lg font-bold text-gray-100 text-center">Quantidade</h4>
                    <div class="flex items-center justify-center gap-4">
                        <button onclick="app.updateComboModalQuantity(-1)" class="bg-gray-700 text-white w-10 h-10 rounded-full font-bold text-xl flex items-center justify-center hover:bg-gray-600 transition-colors">-</button>
                        <span id="combo-modal-quantity" class="font-bold text-3xl text-white w-12 text-center">1</span>
                        <button onclick="app.updateComboModalQuantity(1)" class="bg-gray-700 text-white w-10 h-10 rounded-full font-bold text-xl flex items-center justify-center hover:bg-gray-600 transition-colors">+</button>
                    </div>
                </div>
            `;

            app.elements.comboSizeModalBody.querySelectorAll('input[name="combo_size"]').forEach(radio => {
                radio.addEventListener('change', () => { app.elements.selectComboSizeBtn.disabled = false; });
            });
            app.elements.selectComboSizeBtn.disabled = true;
            app.elements.selectComboSizeBtn.onclick = () => {
                const selected = document.querySelector('input[name="combo_size"]:checked');
                const quantity = parseInt(document.getElementById('combo-modal-quantity').textContent);
                if (selected) {
                    const comboProduct = app.products.find(p => p.id.toString() === app.selectedComboProductId.toString());
                    app.currentItem = {
                        id: comboProduct.id, name: comboProduct.name,
                        basePrice: parseFloat(selected.dataset.price), price: parseFloat(selected.dataset.price),
                        quantity: quantity, toppings: [], type: comboProduct.type,
                        selectedSize: selected.value, description: comboProduct.description
                    };
                    app.addToCart(); // We call addToCart which now handles quantity correctly
                    app.closeComboSizeModal();
                }
            };
            app.openModal(app.elements.comboSizeModal);
        },
        closeComboSizeModal() { app.closeModal(app.elements.comboSizeModal); app.selectedComboProductId = null; },
        updateComboModalQuantity(change) {
            const quantityEl = document.getElementById('combo-modal-quantity');
            if (!quantityEl) return;
            let currentQuantity = parseInt(quantityEl.textContent);
            if (currentQuantity + change >= 1) {
                quantityEl.textContent = currentQuantity + change;
            }
        },
        updateModalQuantity(change) {
            const quantityEl = document.getElementById('modal-quantity');
            if (!quantityEl || !app.currentItem) return;

            let currentQuantity = app.currentItem.quantity || 1;
            if (currentQuantity + change >= 1) {
                currentQuantity += change;
                app.currentItem.quantity = currentQuantity;
                quantityEl.textContent = currentQuantity;
                app.updateModalItemTotal();
            }
        },
        toggleDeliveryFields() {
            const deliveryOption = document.querySelector('input[name="delivery_option"]:checked')?.value;
            app.elements.deliveryFields.classList.toggle('hidden', deliveryOption === 'takeout' || !deliveryOption);
            app.renderCart();
        },
        renderDeliveryOptions() {
            const deliveryRadio = app.elements.deliveryOptionDelivery.querySelector('input');
            const takeoutRadio = app.elements.deliveryOptionTakeout.querySelector('input');
            
            app.elements.deliveryOptionDelivery.classList.add('hidden');
            deliveryRadio.disabled = true;
            app.elements.deliveryOptionTakeout.classList.add('hidden');
            takeoutRadio.disabled = true;

            let availableOptions = [];
            if (['both', 'delivery'].includes(app.adminSettings.deliveryMode)) {
                app.elements.deliveryOptionDelivery.classList.remove('hidden');
                deliveryRadio.disabled = false;
                availableOptions.push('delivery');
            }
            if (['both', 'takeout'].includes(app.adminSettings.deliveryMode)) {
                app.elements.deliveryOptionTakeout.classList.remove('hidden');
                takeoutRadio.disabled = false;
                availableOptions.push('takeout');
            }

            if (!app.isDeliveryTime && ['both', 'delivery'].includes(app.adminSettings.deliveryMode)) {
                deliveryRadio.disabled = true;
                app.elements.deliveryOptionDelivery.classList.add('opacity-50', 'cursor-not-allowed');
                availableOptions = availableOptions.filter(o => o !== 'delivery');
            } else {
                 app.elements.deliveryOptionDelivery.classList.remove('opacity-50', 'cursor-not-allowed');
            }

            const currentSelected = document.querySelector('input[name="delivery_option"]:checked');
            if (!currentSelected || currentSelected.disabled) {
                if (availableOptions.includes('takeout') && !takeoutRadio.disabled) takeoutRadio.checked = true;
                else if (availableOptions.includes('delivery') && !deliveryRadio.disabled) deliveryRadio.checked = true;
            }
            app.toggleDeliveryFields();
        },
        // --- ADMIN PANEL (Functionality unchanged, UI kept separate) ---
        renderAdminPanel() { app.elements.adminBody.innerHTML = `<p class="text-center">A interface do painel de administrador foi mantida funcional e n칚o segue o tema escuro.</p><p class="text-center mt-4">Clique em "Salvar" para aplicar as configura칞칫es atuais ou "Restaurar" para limpar os dados.</p>`; },
        saveAdminChanges() { app.showAlert('As configura칞칫es foram salvas.', 'Salvo'); app.closeAdminModal(); },
        resetToDefaults() {
            localStorage.clear();
            app.showAlert('Configura칞칫es restauradas! A p치gina ser치 recarregada.', 'Sucesso');
            setTimeout(() => window.location.reload(), 2000);
        },

        // --- INITIALIZATION ---
        initializeApp() {
            app.loadLocalData();
            
            // =========================================================
            //  MODIFICA칂츾O PARA LIBERAR DELIVERY DURANTE O FERIADO
            //  ESTA L칍GICA FOI MANTIDA DO C칍DIGO ANTERIOR, MAS COM OS NOVOS HOR츼RIOS
            // =========================================================
            const isHoliday = false; // DEFINIR COMO 'false' AP칍S O FERIADO
            if (isHoliday) {
                // For칞a o hor치rio de in칤cio do delivery para 00:00, liberando-o assim que a loja abre
                app.adminSettings.weekdayDeliveryStartTime = '00:00';
                app.adminSettings.weekendDeliveryStartTime = '00:00';
                console.log("MODO FERIADO: Delivery liberado a partir da abertura da loja.");
            }
            // =========================================================

            app.loadCart();
            app.loadCustomerInfo();
            app.loadCouponHistory(); 
            
            const whatsappUrl = `https://wa.me/${app.adminSettings.whatsappNumber}`;
            app.elements.storeAddressDisplay.textContent = app.adminSettings.address;
            app.elements.whatsappLink.href = whatsappUrl;
            app.elements.messageButtonLink.href = whatsappUrl;


            app.checkStoreStatus();
            setInterval(app.checkStoreStatus, 60 * 1000);

            // Initialize and start the online counter
            app.elements.onlineCount.textContent = Math.floor(Math.random() * (20 - 4 + 1)) + 4;
            app.updateOnlineCounter();

            // Event listeners
            app.elements.addToCartBtn.addEventListener('click', () => { app.addToCart(); app.closeItemModal(); });
            app.elements.customerNameInput.addEventListener('input', app.saveCustomerInfo);
            app.elements.customerAddressInput.addEventListener('input', app.saveCustomerInfo);
            app.elements.neighborhoodSelect.addEventListener('change', () => { app.saveCustomerInfo(); app.renderCart(); });
            app.elements.deliveryOptionRadios.forEach(radio => radio.addEventListener('change', () => { app.toggleDeliveryFields(); app.saveCustomerInfo(); }));
            app.elements.adminPasswordInput.addEventListener('keypress', e => { if (e.key === 'Enter') app.checkAdminPassword(); });
        }
    };
    
    document.addEventListener('DOMContentLoaded', app.initializeApp);
    </script>
</body>
</html>
